<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlackReaper | Stats</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="icon" type="image/png" href="assets/images/mask.png">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <!-- Chart.js (for data visualization) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .chart-container {
            position: relative;
            height: 250px;
            width: 100%;
        }
        
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .achievement-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            border-left: 4px solid var(--accent);
        }
        
        .achievement-card.unlocked {
            border-left-color: #9c27b0;
        }
        
        .achievement-card.locked {
            opacity: 0.6;
        }
        
        .achievement-icon {
            font-size: 2rem;
            margin-right: 15px;
        }
        
        .achievement-details h3 {
            margin: 0 0 5px 0;
            font-size: 1rem;
        }
        
        .achievement-details p {
            margin: 0;
            font-size: 0.9rem;
            color: var(--text);
            opacity: 0.8;
        }
        
        /* Responsive layout */
        @media (max-width: 768px) {
            .stats-dashboard {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Nav bar -->
    <nav class="navbar">
        <div class="nav-logo">
            <img src="assets/images/mask.png" alt="Kaneki Mask" class="mini-mask">
            <span>BlackReaper</span>
        </div>
        <ul class="nav-links">
            <li><a href="dashboard.html">Dashboard</a></li>
            <li><a href="journal.html">Journal</a></li>
            <li><a href="profile.html">Profile</a></li>
            <li><a href="stats.html" class="active">Stats</a></li>
        </ul>
        <div class="nav-actions">
            <div class="mode-toggle">
                <span>Human</span>
                <label class="switch">
                    <input type="checkbox" id="mode-toggle">
                    <span class="slider"></span>
                </label>
                <span>Ghoul</span>
            </div>
            <button id="logout-btn">Logout</button>
        </div>
    </nav>

    <div class="container">
        <h1>Your <span class="text-danger">Statistics</span></h1>
        <p>Track your progress and behavior patterns</p>
        
        <!-- Stats Dashboard -->
        <div class="stats-dashboard">
            <div class="stat-card">
                <h2>Activity by Time of Day</h2>
                <div class="chart-container">
                    <canvas id="timeOfDayChart"></canvas>
                </div>
            </div>
            
            <div class="stat-card">
                <h2>Mood Distribution</h2>
                <div class="chart-container">
                    <canvas id="moodChart"></canvas>
                </div>
            </div>
            
            <div class="stat-card">
                <h2>Human vs Ghoul Time</h2>
                <div class="chart-container">
                    <canvas id="modeChart"></canvas>
                </div>
            </div>
            
            <div class="stat-card">
                <h2>Weekly Activity</h2>
                <div class="chart-container">
                    <canvas id="weeklyChart"></canvas>
                </div>
            </div>
        </div>
        
        <h2>Achievements</h2>
        <div class="achievements-grid" id="achievements-container">
            <!-- Achievements will be populated by JavaScript -->
        </div>

        <!-- Audio Controls -->
        <div class="audio-controls">
            <button id="toggle-audio">
                <span class="audio-on">ðŸ”Š</span>
                <span class="audio-off hidden">ðŸ”‡</span>
            </button>
            <audio id="background-audio" loop>
                <source src="assets/audio/background.mp3" type="audio/mp3">
            </audio>
        </div>
    </div>

    <!-- Scripts -->
    <script src="firebase/config.js"></script>
    <script src="firebase/auth.js"></script>
    <script src="firebase/database.js"></script>
    <script src="assets/js/notifications.js"></script>
    <script src="assets/js/kagune.js"></script>
    <script src="assets/js/analytics.js"></script>
    <script src="assets/js/main.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Load user statistics
            const analytics = window.BlackReaperAnalytics.getAnalyticsSummary();
            
            // Create charts
            createTimeOfDayChart(analytics.visitsByTimeOfDay);
            createMoodChart(analytics.moodDistribution);
            createModeChart(analytics.timeInHumanMode, analytics.timeInGhoulMode);
            createWeeklyChart(analytics.activityByDay);
            
            // Load and display achievements
            loadAchievements();
        });
        
        // Create time of day chart
        function createTimeOfDayChart(data) {
            const ctx = document.getElementById('timeOfDayChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Morning', 'Afternoon', 'Evening', 'Night'],
                    datasets: [{
                        data: [
                            data.morning || 1,
                            data.afternoon || 1,
                            data.evening || 1,
                            data.night || 1
                        ],
                        backgroundColor: [
                            '#FFD700', // Morning - Gold
                            '#FF6B6B', // Afternoon - Red
                            '#5D5C61', // Evening - Dark Gray
                            '#2D2D2D'  // Night - Black
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: getComputedStyle(document.body).getPropertyValue('--text')
                            }
                        }
                    }
                }
            });
        }
        
        // Create mood distribution chart
        function createMoodChart(data) {
            const moods = Object.keys(data);
            const counts = Object.values(data);
            
            const ctx = document.getElementById('moodChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: moods.length > 0 ? moods : ['No Data'],
                    datasets: [{
                        label: 'Frequency',
                        data: counts.length > 0 ? counts : [0],
                        backgroundColor: [
                            '#4caf50', // Calm - Green
                            '#ff9800', // Anxious - Orange
                            '#f44336', // Angry - Red
                            '#9c27b0', // Hungry - Purple
                            '#607d8b'  // Broken - Blue Gray
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text')
                            }
                        },
                        x: {
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text')
                            }
                        }
                    }
                }
            });
        }
        
        // Create mode usage chart
        function createModeChart(humanTime, ghoulTime) {
            const ctx = document.getElementById('modeChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Human Mode', 'Ghoul Mode'],
                    datasets: [{
                        data: [humanTime || 1, ghoulTime || 1],
                        backgroundColor: [
                            '#2196f3', // Human - Blue
                            '#e10000'  // Ghoul - Red
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: getComputedStyle(document.body).getPropertyValue('--text')
                            }
                        }
                    }
                }
            });
        }
        
        // Create weekly activity chart
        function createWeeklyChart(data) {
            const ctx = document.getElementById('weeklyChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                    datasets: [{
                        label: 'Activity',
                        data: [
                            data.sunday || 0,
                            data.monday || 0,
                            data.tuesday || 0,
                            data.wednesday || 0,
                            data.thursday || 0,
                            data.friday || 0,
                            data.saturday || 0
                        ],
                        fill: true,
                        backgroundColor: 'rgba(225, 0, 0, 0.2)',
                        borderColor: 'rgba(225, 0, 0, 1)',
                        borderWidth: 2,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text')
                            }
                        },
                        x: {
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text')
                            }
                        }
                    }
                }
            });
        }
        
        // Load and display achievements
        function loadAchievements() {
            const container = document.getElementById('achievements-container');
            const achievedList = JSON.parse(localStorage.getItem('achievements') || '[]');
            
            // Get achievements from analytics.js
            const achievements = [
                {
                    id: 'first_journal',
                    name: 'First Confession',
                    description: 'Create your first journal entry',
                    icon: 'ðŸ“'
                },
                {
                    id: 'task_master',
                    name: 'Task Master',
                    description: 'Complete 10 tasks',
                    icon: 'âœ“'
                },
                {
                    id: 'dedicated_ghoul',
                    name: 'Dedicated Ghoul',
                    description: 'Spend over 1 hour in Ghoul Mode',
                    icon: 'ðŸ‘ï¸'
                },
                {
                    id: 'dark_writer',
                    name: 'Dark Writer',
                    description: 'Write 5 journal entries in Ghoul Mode',
                    icon: 'âœ’ï¸'
                },
                {
                    id: 'kagune_master',
                    name: 'Kagune Master',
                    description: 'Unlock all Kagune types',
                    icon: 'ðŸ”¥'
                },
                {
                    id: 'rc_overload',
                    name: 'RC Cell Overload',
                    description: 'Reach maximum RC level',
                    icon: 'âš¡'
                },
                {
                    id: 'consistent_user',
                    name: 'Consistent User',
                    description: 'Use the app for 7 consecutive days',
                    icon: 'ðŸ“†'
                },
                {
                    id: 'night_owl',
                    name: 'Night Owl',
                    description: 'Use the app after midnight',
                    icon: 'ðŸ¦‰'
                }
            ];
            
            // Create achievement cards
            achievements.forEach(achievement => {
                const isUnlocked = achievedList.includes(achievement.id);
                
                const card = document.createElement('div');
                card.className = `achievement-card ${isUnlocked ? 'unlocked' : 'locked'}`;
                
                card.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-details">
                        <h3>${achievement.name}</h3>
                        <p>${achievement.description}</p>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }
    </script>
</body>
</html>
